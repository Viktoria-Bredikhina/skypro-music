{"ast":null,"code":"import { createApi, fetchBaseQuery } from \"@reduxjs/toolkit/query/react\";\nimport { setAuth } from \"../store/slices/AuthorizationSlice\";\nconst baseQueryWithReauth = async (args, api, extraOptions) => {\n  var _result$error, _retryResult$error;\n  const baseQuery = fetchBaseQuery({\n    baseUrl: \"https://skypro-music-api.skyeng.tech\",\n    prepareHeaders: (headers, {\n      getState\n    }) => {\n      const token = getState().auth.access;\n      if (token) {\n        headers.set(\"authorization\", `Bearer ${token}`);\n      }\n      return headers;\n    }\n  });\n  const result = await baseQuery(args, api, extraOptions);\n  if ((result === null || result === void 0 ? void 0 : (_result$error = result.error) === null || _result$error === void 0 ? void 0 : _result$error.status) !== 401) {\n    return result;\n  }\n  const Logout = () => {\n    api.dispatch(setAuth(null));\n  };\n  const {\n    auth\n  } = api.getState();\n  if (!auth.refresh) {\n    return Logout();\n  }\n  const refreshToken = await baseQuery({\n    url: \"user/token/refresh/\",\n    method: \"POST\",\n    body: {\n      refresh: auth.refresh\n    }\n  }, api, extraOptions);\n  if (!refreshToken.data.access) {\n    return Logout();\n  }\n  api.dispatch(setAuth({\n    ...auth,\n    access: refreshToken.data.access\n  }));\n  const retryResult = await baseQuery(args, api, extraOptions);\n  if ((retryResult === null || retryResult === void 0 ? void 0 : (_retryResult$error = retryResult.error) === null || _retryResult$error === void 0 ? void 0 : _retryResult$error.status) === 401) {\n    return Logout();\n  }\n  return retryResult;\n};\nexport const tracksQuery = createApi({\n  reducerPath: `tracksQuery`,\n  tagTypes: [\"Tracks\", \"Favorites\"],\n  baseQuery: baseQueryWithReauth,\n  endpoints: builder => ({\n    getTracksAll: builder.query({\n      query: () => \"catalog/track/all/\",\n      providesTags: result => result ? [...result.map(({\n        id\n      }) => ({\n        type: \"Tracks\",\n        id\n      })), {\n        type: \"Tracks\",\n        id: \"LIST\"\n      }] : [{\n        type: \"Tracks\",\n        id: \"LIST\"\n      }]\n    }),\n    getFavouriteTracksAll: builder.query({\n      query: () => \"catalog/track/favorite/all/\",\n      providesTags: result => result ? [...result.map(({\n        id\n      }) => ({\n        type: \"Tracks\",\n        id\n      })), {\n        type: \"Tracks\",\n        id: \"LIST\"\n      }] : [{\n        type: \"Tracks\",\n        id: \"LIST\"\n      }]\n    }),\n    setLike: builder.mutation({\n      query: track => ({\n        url: `catalog/track/${track.id}/favorite/`,\n        method: \"POST\"\n      }),\n      invalidatesTags: [{\n        type: \"Favorites\",\n        id: \"LIST\"\n      }, {\n        type: \"Tracks\",\n        id: \"LIST\"\n      }]\n    }),\n    setDislike: builder.mutation({\n      query: track => ({\n        url: `catalog/track/${track.id}/favorite/`,\n        method: \"DELETE\"\n      }),\n      invalidatesTags: [{\n        type: \"Favorites\",\n        id: \"LIST\"\n      }, {\n        type: \"Tracks\",\n        id: \"LIST\"\n      }]\n    }),\n    getSelections: builder.query({\n      query: id => `catalog/selection/${id}/`,\n      providesTags: result => result ? [...result.items.map(({\n        id\n      }) => ({\n        type: \"Selections\",\n        id\n      })), {\n        type: \"Selections\",\n        id: \"LIST\"\n      }] : [{\n        type: \"Selections\",\n        id: \"LIST\"\n      }]\n    })\n  })\n});\nexport const {\n  useGetTracksAllQuery,\n  useGetFavouriteTracksAllQuery,\n  useSetLikeMutation,\n  useSetDislikeMutation,\n  useGetSelectionsQuery\n} = tracksQuery;","map":{"version":3,"names":["createApi","fetchBaseQuery","setAuth","baseQueryWithReauth","args","api","extraOptions","_result$error","_retryResult$error","baseQuery","baseUrl","prepareHeaders","headers","getState","token","auth","access","set","result","error","status","Logout","dispatch","refresh","refreshToken","url","method","body","data","retryResult","tracksQuery","reducerPath","tagTypes","endpoints","builder","getTracksAll","query","providesTags","map","id","type","getFavouriteTracksAll","setLike","mutation","track","invalidatesTags","setDislike","getSelections","items","useGetTracksAllQuery","useGetFavouriteTracksAllQuery","useSetLikeMutation","useSetDislikeMutation","useGetSelectionsQuery"],"sources":["/Users/viktoriabredihina/Downloads/skypro-music/src/serviseQuery/tracks.jsx"],"sourcesContent":["import { createApi, fetchBaseQuery } from \"@reduxjs/toolkit/query/react\";\nimport { setAuth } from \"../store/slices/AuthorizationSlice\";\n\nconst baseQueryWithReauth = async (args, api, extraOptions) => {\n  const baseQuery = fetchBaseQuery({\n    baseUrl: \"https://skypro-music-api.skyeng.tech\",\n    prepareHeaders: (headers, { getState }) => {\n      const token = getState().auth.access;\n\n      if (token) {\n        headers.set(\"authorization\", `Bearer ${token}`);\n      }\n      return headers;\n    },\n  });\n\n  const result = await baseQuery(args, api, extraOptions);\n\n  if (result?.error?.status !== 401) {\n    return result;\n  }\n  const Logout = () => {\n    api.dispatch(setAuth(null));\n  };\n\n  const { auth } = api.getState();\n\n  if (!auth.refresh) {\n    return Logout();\n  }\n\n  const refreshToken = await baseQuery(\n    {\n      url: \"user/token/refresh/\",\n      method: \"POST\",\n      body: {\n        refresh: auth.refresh,\n      },\n    },\n    api,\n    extraOptions\n  );\n\n  if (!refreshToken.data.access) {\n    return Logout();\n  }\n\n  api.dispatch(setAuth({ ...auth, access: refreshToken.data.access }));\n\n  const retryResult = await baseQuery(args, api, extraOptions);\n\n  if (retryResult?.error?.status === 401) {\n    return Logout();\n  }\n  return retryResult;\n};\n\nexport const tracksQuery = createApi({\n  reducerPath: `tracksQuery`,\n  tagTypes: [\"Tracks\", \"Favorites\"],\n  baseQuery: baseQueryWithReauth,\n\n  endpoints: (builder) => ({\n    getTracksAll: builder.query({\n      query: () => \"catalog/track/all/\",\n      providesTags: (result) =>\n        result\n          ? [\n              ...result.map(({ id }) => ({ type: \"Tracks\", id })),\n              { type: \"Tracks\", id: \"LIST\" },\n            ]\n          : [{ type: \"Tracks\", id: \"LIST\" }],\n    }),\n    getFavouriteTracksAll: builder.query({\n      query: () => \"catalog/track/favorite/all/\",\n      providesTags: (result) =>\n        result\n          ? [\n              ...result.map(({ id }) => ({ type: \"Tracks\", id })),\n              { type: \"Tracks\", id: \"LIST\" },\n            ]\n          : [{ type: \"Tracks\", id: \"LIST\" }],\n    }),\n\n    setLike: builder.mutation({\n      query: (track) => ({\n        url: `catalog/track/${track.id}/favorite/`,\n        method: \"POST\",\n      }),\n      invalidatesTags: [\n        { type: \"Favorites\", id: \"LIST\" },\n        { type: \"Tracks\", id: \"LIST\" },\n      ],\n    }),\n\n    setDislike: builder.mutation({\n      query: (track) => ({\n        url: `catalog/track/${track.id}/favorite/`,\n        method: \"DELETE\",\n      }),\n      invalidatesTags: [\n        { type: \"Favorites\", id: \"LIST\" },\n        { type: \"Tracks\", id: \"LIST\" },\n      ],\n    }),\n    getSelections: builder.query({\n      query: (id) => `catalog/selection/${id}/`,\n      providesTags: (result) =>\n        result\n          ? [\n              ...result.items.map(({ id }) => ({ type: \"Selections\", id })),\n              { type: \"Selections\", id: \"LIST\" },\n            ]\n          : [{ type: \"Selections\", id: \"LIST\" }],\n    }),\n  }),\n});\n\nexport const {\n  useGetTracksAllQuery,\n  useGetFavouriteTracksAllQuery,\n  useSetLikeMutation,\n  useSetDislikeMutation,\n  useGetSelectionsQuery,\n} = tracksQuery;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}